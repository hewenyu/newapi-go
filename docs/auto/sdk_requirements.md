# New-API Go SDK 需求文档

本文档总结了 `new-api` Go SDK 的设计与实现需求。

## 1. 核心目标

开发一个 Go 语言的软件开发工具包 (SDK)，为 `new-api` 服务提供便捷、高效的接口调用方式。

## 2. 整体设计

*   **客户端模式**: 采用单一、全功能客户端模式 (`All-in-One Client`)。客户端实例一经创建，应保证并发安全，可在多个 goroutine 中共享。
*   **API 兼容性**: SDK 解析 API 响应时，将忽略未在结构体中定义的字段。这种策略旨在确保当 `new-api` 升级并添加新字段时，不会破坏现有客户端的稳定性。

## 3. 功能范围 (V1)

SDK 的第一个版本将优先实现以下四个核心功能模块：

*   **聊天 (Chat)**: 包含对流式 (Streaming) 响应的支持。
*   **嵌入 (Embeddings)**
*   **图像 (Image)**
*   **音频 (Audio)**

## 4. 客户端配置

SDK 客户端 `Client` 在初始化时应支持以下配置：

*   `API 密钥` (必选): 用于请求认证。
*   `服务器地址` (可选): `new-api` 服务的基础 URL，如果未提供，则使用一个默认的公共地址。
*   `请求超时时间` (可选): HTTP 请求的超时限制，如果未提供，则使用一个合理的默认值。
*   `自定义 http.Client` (可选): 允许用户注入一个自定义的 `*http.Client` 实例，以支持代理、自定义中间件等高级用例。

## 5. 核心技术要求

*   **上下文传递 (Context Propagation)**: 所有执行网络请求的公开方法，都必须接受 `context.Context` 作为其第一个参数，以便于调用方对请求进行超时控制和取消操作。
*   **错误处理**: SDK 不会对 `new-api` 返回的错误进行封装或转换。它将直接返回 API 的原始错误信息，交由业务逻辑层处理。
*   **日志系统**: SDK 内部将集成 `go.uber.org/zap` 作为标准的日志记录库。

## 6. 超出范围 (V1)

以下功能在当前版本中不予考虑：

*   **请求自动重试**: 业务逻辑层可根据需要自行实现。
*   **其他 API 模块**: `重排序 (Rerank)`, `实时 (Realtime)`, `音乐 (Music)` 等接口将作为后期规划。 